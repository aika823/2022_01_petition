{% extends "base.html" %}

{% block content %}
<!-- <header class="title-page">
  <div class="title">
    <a href="javascript:void(0)" onclick="location.href='./check.html'"><i class="fas fa-times"></i></a>
  </div>
  <div class="header-title">
    <h3>ì²­ì› ì‘ì„±</h3>
  </div>
</header> -->

<!-- section.write -->
<section class="write template">
  <form id="formPetition" action="/success" method="post" enctype="multipart/form-data">

    {% csrf_token %}
    <input type="hidden" name="title" value="{{title}}">
    <input type="hidden" name="category" value="{{category}}">
    <input type="hidden" name="department" value="{{department}}">
    <input type="file" name="thumbnail" id="imageInput" style="display: none" />
    <input type="file" name="images" id="imagesInput" style="display: none" multiple />


    <div class="form-header">
      <a href="javascript:void(0)" onclick="location.href='./check.html'"><i class="fas fa-times"></i></a>
      <h3>ì²­ì› ì‘ì„±</h3>
      {# <button type="submit" class="btn-submit" form="formPetition">ì™„ë£Œ</button> #}
      <button type="button" class="btn-submit">ì™„ë£Œ</button>
    </div>

    <div id="thumbnailImage2" style="backgroud-image:url();">
    </div>

    <div id="thumbnailImage" class="form-row form-row--image">
      <a class="btn-img" href="javascript:void(0)" onclick="open_image_input()">
        <i class="fas fa-plus"></i>
        <p>ëŒ€í‘œ ì´ë¯¸ì§€ ì¶”ê°€</p>
      </a>
    </div>

    <div class="title-wrap">
      <h2 class="write-title">{{title}}</h2>
      <div class="category-tag">
        <div class="tag">
          <p>ì¹´í…Œê³ ë¦¬</p>
          <p class="category">{{category}}</p>
        </div>
        <div class="tag">
          <p>í¬ë§ ìˆ˜ì‹ ì</p>
          <p class="receiver">{{department}}</p>
        </div>
      </div>
    </div>

    <div class="line"></div>

    <div class="template-form-item">
      <h3>ğŸ’­ ì²­ì›ì„ ì‘ì„±í•œ ë°°ê²½</h3>
      <textarea name="content_1" id="" placeholder="ì²­ì›ì„ í•˜ê²Œ ëœ ë°°ê²½ì„ ìƒì„¸í•˜ê²Œ ì ì–´ì£¼ì„¸ìš”."></textarea>
    </div>

    <div class="line"></div>

    <div class="template-form-item">
      <h3>ğŸ“‘ ì œì•ˆí•˜ëŠ” ì •ì±…ì˜ íš¨ê³¼</h3>
      <textarea name="content_2" id="" placeholder="ê²½í—˜í–ˆë˜ ì‚¬ì‹¤ì„ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ í•´ì£¼ì„¸ìš”.
ê¸°ì‚¬, ì±…, ë…¼ë¬¸, SNS ìë£Œ ë“± ì²­ìë¥¼ ë‚©ë“ì‹œí‚¬ ìˆ˜
ìˆëŠ” ê·¼ê±°ë“¤ì„ í™œìš©í•´ì„œ ì ì–´ì£¼ì„¸ìš”."></textarea>
    </div>

    <div class="line"></div>

    <div class="template-form-item">
      <h3>âœ¨ ì²­ì›ì´ ì´ë£¨ì–´ì§€ë©´ ì–´ë–¤ íš¨ê³¼ê°€ ìˆì„ê¹Œìš”?</h3>
      <textarea name="content_7" id="" placeholder="ê³µìµì ìœ¼ë¡œ íš¨ê³¼ê°€ ìˆì–´ì•¼ ì •ì±…ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.
ìš”ì²­í•˜ëŠ” ì²­ì›ì´ ì´ë£¨ì–´ì§„ ì„¸ìƒì€ ì–´ë–»ê²Œ ë°”ë€”ì§€,
ì–´ë–¤ íš¨ê³¼ê°€ ìˆì„ì§€ ê¸°ìˆ í•´ì£¼ì„¸ìš”."></textarea>
    </div>

    <div class="line"></div>

    <div class="template-form-item">
      <h3>ì´í•´ë¥¼ ë•ê¸° ìœ„í•œ ì‚¬ì§„ ì²¨ë¶€</h3>
      <p>ì²­ì›ê¸€ì— ì‚¬ì§„ì´ ìˆìœ¼ë©´ ë” ë§ì€ ì‚¬ëŒë“¤ì´ í™•ì¸í•´ìš”.</p>

      <div id="preview" class="image-wrap">
        <!-- <div class="uploaded-img" style="background-image: url('/static/images/sample1.png');"></div>
        <div class="uploaded-img" style="background-image: url('/static/images/sample3.png');"></div> -->
        <a class="add-img" onclick="open_images_input()">
          <div class="inner">
            <p><i class="fas fa-plus"></i></p>
            <p><span class="img-count">0</span> / 10</p>
          </div>
        </a>
      </div>
    </div>

    <div class="line"></div>

    <div class="template-form-item">
      <h3>ğŸ”– í•µì‹¬ ë‹¨ì–´ ì„¸ ê°€ì§€</h3>
      <p>ë‹¤ë¥¸ ì‹œë¯¼ë“¤ì´ ì´ ì²­ì›ì„ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ë„ì™€ìš”</p>
      <div class="tag-keywords">
        <p class="keyword"># <input type="text" name="keyword_1"></p>
        <p class="keyword"># <input type="text" name="keyword_2"></p>
        <p class="keyword"># <input type="text" name="keyword_3"></p>
      </div>
    </div>

    <div class="edit-tools">
      <a href="javascript:void(0)">
        <span class="material-icons-outlined">title</span>
      </a>
      <a href="javascript:void(0)">
        <span class="material-icons-outlined">keyboard_voice</span>
      </a>
      <a class="blue" href="javascript:void(0)">
        <span class="material-icons-outlined">add</span>
      </a>
    </div>
  </form>

</section>

<section class="modal_wrap">
  <article class="modal_cnt">
    <div class="modal_body">
      <h4>
        ë¶€ì ì ˆ í‘œí˜„ ê°ì§€
        <br>AI ë¶„ì„ ì¤‘...
      </h4>
      <div class="img-wrap">
        <img src="/static/images/loading.png" alt="">
      </div>
    </div>
    <a href="javascript:void(0)" class="close_btn">ë‹«ê¸°</a>
  </article>
  <div class="modal_dim"></div>
</section>
{% endblock content %}


{% block extrascripts %}
<script>
  $('#title').click(function () {
    $('.line').animate({
      "width": "100%"
    }, 400)
  });
</script>

<script>
  $('.btn-template').click(function () {
    $('.btn-template').removeClass('active');
    $(this).addClass('active');
  });
</script>


<script type="text/javascript">
  function open_image_input() {
    document.getElementById("imageInput").click();
  }

  function open_images_input() {
    $('#imagesInput').click();
  }

  $('#imageInput').change(function () {
    var file = this.files[0];
    var reader = new FileReader();
    reader.onloadend = function () {
      $('#thumbnailImage').css('background-image', 'url("' + reader.result + '")');
    }
    if (file) {
      reader.readAsDataURL(file);
    } else {}
  });


  $('#imagesInput').change(function () {
    var $preview = $('#preview');
    $img_count = $('.img-count');

    if ($img_count.text() == "10") {
      alert("ì‚¬ì§„ì€ 10ì¥ê¹Œì§€ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    } else {
      if (this.files) $.each(this.files, readAndPreview);
      $img_count.text(String($('.uploaded-img').length + 1))
    }

    function readAndPreview(i, file) {
      var tmp_images = []
      if (!/\.(jpe?g|png|gif)$/i.test(file.name)) {
        return alert(file.name + " íŒŒì¼ì€ ì´ë¯¸ì§€ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.");
      }

      var reader = new FileReader();
      $(reader).on("load", function () {

        $preview.prepend(
          $(
            "<div />", {
              class: "uploaded-img",
              style: "background-image: url('" + this.result + "' )",
            }
          )
        );
      });
      reader.readAsDataURL(file);
    }



  });

  $('.open-input').click(function () {
    $('.username-form').toggleClass('active');
    $('.profile-tag-form').toggleClass('active');
  });


</script>

<script>
  $body = $('body');
  $modalWrap = $('.modal_wrap');

  $('.btn-submit').on('click', function () {
    $body.addClass('modal_in');
    $modalWrap.fadeIn(300);
    $body.css('padding-right', getScrollWidth());
    formSubmit();
  });

  $('.close_btn, .modal_dim').on('click', function () {
    var speed = 300;
    $modalWrap.fadeOut(speed);
    setTimeout(function () {
      $body.removeClass('modal_in');
      $body.css('padding-right', 0)
    }, speed)
  });

  function getScrollWidth() {
    var body = document.querySelector('body');
    var scrollDiv = document.createElement('div');
    scrollDiv.className = 'fake_sjwidth';
    body.appendChild(scrollDiv);
    var scrollbarWidth = $(document).height() > $(window).height() ? scrollDiv.offsetWidth - scrollDiv.clientWidth :
      0;

    body.removeChild(scrollDiv);
    return scrollbarWidth;
  }

  function formSubmit() {
    console.log("function formSubmit()");
    var params = $("#formPetition").serialize();
    console.log(params);
    $.ajax({
      url: '/api/check_validation',
      type: 'POST',
      data: params,
      contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
      dataType: 'html',
      success: function (data) {
        data = JSON.parse(data)
        console.log(data);
        console.log(data.content_1.prediction);
        console.log(data.content_2.prediction);
        console.log(data.content_7.prediction);
      }
    });
  }
</script>
{% endblock extrascripts %}